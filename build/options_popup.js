// Generated by CoffeeScript 1.6.1
(function() {

  window.relater_to_send = null;

  chrome.runtime.onMessage.addListener(function(request, sender, sendResponse) {
    console.log("request received");
    if (window.relater_to_send === null || window.relater_to_send === void 0) {
      window.relater_to_send = new User(request.relater_to_send);
    }
    if (window.relater_to_send.id === request.relater_id) {
      window.options_for_messages = chrome.extension.getBackgroundPage().options_for_message;
      window.transformed_message = request.transformed_message;
      return loadMessages();
    }
  });

  window.loadMessages = function() {
    var message_collection_view, messages_container_view, relater_threads, relater_threads_view;
    relater_threads = chrome.extension.getBackgroundPage().getRelaterThread(window.relater_to_send.id);
    messages_container_view = new MessagesViewContainer();
    $(".container").html(messages_container_view.render().$el);
    relater_threads_view = new ThreadsCollectionView({
      "collection": relater_threads
    });
    message_collection_view = new MessageCollectionView({
      "collection": window.options_for_messages
    });
    $("#messages_container").html(message_collection_view.render().el);
    $("#threads_container").html(relater_threads_view.render().el);
    $("#message_head").html(window.transformed_message);
    return $("title").html(window.transformed_message);
  };

  window.initializeWindow = function() {
    return chrome.extension.getBackgroundPage().sendBroadcastMessage();
  };

  window.addEventListener("DOMContentLoaded", initializeWindow, false);

}).call(this);
