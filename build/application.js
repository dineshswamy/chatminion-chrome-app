// Generated by CoffeeScript 1.6.1
(function() {
  'use-strict';
  var initialize_extension, success_stream,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  this.InfoView = (function(_super) {

    __extends(InfoView, _super);

    function InfoView() {
      return InfoView.__super__.constructor.apply(this, arguments);
    }

    InfoView.prototype.render = function(message) {
      this.$el.html(HAML["info_view"]({
        "info": message
      }));
      return this;
    };

    return InfoView;

  })(Backbone.View);

  window.loadRelaters = function(user_id) {
    var add_relaters_view, base_url;
    add_relaters_view = new addRelatersView();
    base_url = chrome.runtime.getBackgroundPage(function(page) {
      return page.base_url;
    });
    console.log("Base URL");
    return console.log(base_url);
  };

  initialize_extension = function() {
    window.peer = new Peer('fight_rigorously', {
      key: '2n9conp4vga2a9k9'
    });
    window.peer.on('call', function(call) {
      navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
      return navigator.getUserMedia({
        video: true,
        audio: true
      }, function(stream) {
        call.answer(stream);
        return call.on('stream', success_stream);
      }, function(err) {
        return console.log('Failed to get local stream', err);
      });
    });
    return $("#start_call").click(function(event) {
      event.preventDefault();
      navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
      return navigator.getUserMedia({
        video: true,
        audio: true
      }, function(stream) {
        var call;
        call = window.peer.call('fight_rigorously_2', stream);
        return call.on('stream', success_stream);
      }, function(err) {
        return console.log('Failed to get local stream', err);
      });
    });
  };

  success_stream = function(remoteStream) {
    return $("#chat_video").attr("src", window.URL.createObjectURL(remoteStream));
  };

  document.addEventListener("DOMContentLoaded", initialize_extension);

}).call(this);
