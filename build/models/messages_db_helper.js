// Generated by CoffeeScript 1.6.1
(function() {

  this.Messages = (function() {

    function Messages() {}

    Messages.prototype.init = function() {
      var _this = this;
      this.version = 2;
      this.database = null;
      this.transaction = null;
      this.messages_url = chrome.extension.getBackgroundPage().base_url + "/messages.json";
      this.message_options_url = chrome.extension.getBackgroundPage() + "/message_options.json";
      this.db_name = "calltheteam";
      this.request = indexedDB.open(this.db_name, this.version);
      this.request.onupgradeneeded = function(event) {
        var db, object_store_messages;
        db = event.target.result;
        if (db.objectStoreNames.contains("messages")) {
          db.deleteObjectStore("messages");
        }
        if (db.objectStoreNames.contains("message_options")) {
          db.deleteObjectStore("message_options");
        }
        return object_store_messages = db.createObjectStore("messages", {
          keyPath: "id"
        });
      };
      this.request.onsuccess = function(event) {
        console.log("database opening good");
        _this.database = event.target.result;
        return _this.fetch();
      };
      return this.request.onerror = function(event) {
        return console.log("database_logging_error" + event.value);
      };
    };

    Messages.prototype.addMessage = function(object_to_store) {
      var request;
      if (this.database !== null) {
        this.transaction = this.database.transaction(["messages"], "readwrite");
        this.store = this.transaction.objectStore("messages");
        request = this.store.put(object_to_store);
        request.onsuccess = function(event) {
          return console.log("message successfully written");
        };
        return request.onerror = function(event) {
          return console.log("insertion error");
        };
      }
    };

    Messages.prototype.addMessageOptions = function(object_to_store) {
      var request;
      if (this.database !== null) {
        this.transaction = this.database.transaction(["message_options"], "readwrite");
        this.store = this.transaction.objectStore("message_options");
        request = this.store.put(object_to_store);
        request.onsuccess = function(event) {
          return console.log("message successfully written");
        };
        return request.onerror = function(event) {
          return console.log("insertion error");
        };
      }
    };

    Messages.prototype.fetch = function() {
      var _this = this;
      return $.get(this.url, function(data) {
        var messages, _i, _len, _results;
        _results = [];
        for (_i = 0, _len = data.length; _i < _len; _i++) {
          messages = data[_i];
          _results.push(_this.addMessage({
            "id": messages.msg_id,
            "user_message": messages.user_message,
            "transform_pattern": messages.transform_pattern
          }));
        }
        return _results;
      });
    };

    Messages.prototype.needToSync = function() {
      var now;
      return now = new Date();
    };

    return Messages;

  })();

}).call(this);
